#!/bin/bash

result=0

MY_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PROJECT_DIR="$( cd "${MY_DIR}"/.. && pwd )"

pushd "${PROJECT_DIR}"
  godep restore

  echo -e "\nFormatting packages..."
  go fmt github.com/cloudfoundry-incubator/route-registrar/...

  echo -e "\nTesting packages..."
  ginkgo -r -failOnPending -randomizeAllSpecs "$@" $MY_DIR/..
  let "result+=$?"
popd

echo -e "\nExit Code: $result"
exit $result
