#!/bin/bash

MY_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PROJECT_DIR="$( cd "${MY_DIR}"/.. && pwd )"

pushd "${PROJECT_DIR}" > /dev/null
  godep restore
popd > /dev/null

go get -v github.com/apcera/gnatsd
go install -v github.com/apcera/gnatsd

echo -e "\nFormatting packages..."
go fmt github.com/cloudfoundry-incubator/route-registrar/...

result=0

echo -e "\nTesting packages..."
pushd "${PROJECT_DIR}"
  ginkgo \
    -r \
    -failOnPending \
    -randomizeAllSpecs \
    -randomizeSuites \
    "$@"
  let "result+=$?"
popd > /dev/null

echo -e "\nExit Code: $result"
exit $result
